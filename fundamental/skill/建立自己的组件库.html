<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>如何建立自己的组件库 | HUI的星球</title>
    <meta name="description" content="种一棵树最好的时间是十年前，其次就是现在">
    <link rel="icon" href="./img/favicon.png">
    
    <link rel="preload" href="/assets/css/0.styles.db4c6190.css" as="style"><link rel="preload" href="/assets/js/app.994bf1ff.js" as="script"><link rel="preload" href="/assets/js/2.9b2c7d50.js" as="script"><link rel="preload" href="/assets/js/23.a3852a2e.js" as="script"><link rel="prefetch" href="/assets/js/10.b16a59af.js"><link rel="prefetch" href="/assets/js/11.2b79ee9e.js"><link rel="prefetch" href="/assets/js/12.c05e9f33.js"><link rel="prefetch" href="/assets/js/13.b60d3b30.js"><link rel="prefetch" href="/assets/js/14.398b832b.js"><link rel="prefetch" href="/assets/js/15.d1e23d73.js"><link rel="prefetch" href="/assets/js/16.5b96b724.js"><link rel="prefetch" href="/assets/js/17.41ef2e99.js"><link rel="prefetch" href="/assets/js/18.9b48ea30.js"><link rel="prefetch" href="/assets/js/19.b49a4c41.js"><link rel="prefetch" href="/assets/js/20.a87da108.js"><link rel="prefetch" href="/assets/js/21.0cef31d7.js"><link rel="prefetch" href="/assets/js/22.e10545a7.js"><link rel="prefetch" href="/assets/js/24.151c73a5.js"><link rel="prefetch" href="/assets/js/25.5d2b9236.js"><link rel="prefetch" href="/assets/js/26.1f357307.js"><link rel="prefetch" href="/assets/js/27.8bcbb102.js"><link rel="prefetch" href="/assets/js/28.22989a80.js"><link rel="prefetch" href="/assets/js/29.c860bc9b.js"><link rel="prefetch" href="/assets/js/3.1d19c98b.js"><link rel="prefetch" href="/assets/js/30.7d6ca048.js"><link rel="prefetch" href="/assets/js/31.2ab3dbdd.js"><link rel="prefetch" href="/assets/js/32.9e6a2c9a.js"><link rel="prefetch" href="/assets/js/33.df2d5c39.js"><link rel="prefetch" href="/assets/js/34.94a3feae.js"><link rel="prefetch" href="/assets/js/35.887270a0.js"><link rel="prefetch" href="/assets/js/36.0a8e7cad.js"><link rel="prefetch" href="/assets/js/37.7e91cf47.js"><link rel="prefetch" href="/assets/js/4.304dbc1b.js"><link rel="prefetch" href="/assets/js/5.e8f2b80f.js"><link rel="prefetch" href="/assets/js/6.5b00ce39.js"><link rel="prefetch" href="/assets/js/7.64d558c0.js"><link rel="prefetch" href="/assets/js/8.ac0858be.js"><link rel="prefetch" href="/assets/js/9.4ae1fa31.js">
    <link rel="stylesheet" href="/assets/css/0.styles.db4c6190.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">HUI的星球</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fundamental/" class="nav-link router-link-active">前端积累</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">前端算法</a></div><div class="nav-item"><a href="/browser/" class="nav-link">浏览器相关</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fundamental/" class="nav-link router-link-active">前端积累</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">前端算法</a></div><div class="nav-item"><a href="/browser/" class="nav-link">浏览器相关</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>原型链</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>异步</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>模块化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>技巧</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fundamental/skill/调试.html" class="sidebar-link">调试技巧</a></li><li><a href="/fundamental/skill/建立自己的组件库.html" class="active sidebar-link">如何建立自己的组件库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fundamental/skill/建立自己的组件库.html#npm发包" class="sidebar-link">npm发包</a></li><li class="sidebar-sub-header"><a href="/fundamental/skill/建立自己的组件库.html#package-json字段解释" class="sidebar-link">package.json字段解释</a></li><li class="sidebar-sub-header"><a href="/fundamental/skill/建立自己的组件库.html#定义依赖" class="sidebar-link">定义依赖</a></li><li class="sidebar-sub-header"><a href="/fundamental/skill/建立自己的组件库.html#忽略文件" class="sidebar-link">忽略文件</a></li><li class="sidebar-sub-header"><a href="/fundamental/skill/建立自己的组件库.html#readme-md" class="sidebar-link">README.md</a></li><li class="sidebar-sub-header"><a href="/fundamental/skill/建立自己的组件库.html#发布" class="sidebar-link">发布</a></li><li class="sidebar-sub-header"><a href="/fundamental/skill/建立自己的组件库.html#打标签" class="sidebar-link">打标签</a></li><li class="sidebar-sub-header"><a href="/fundamental/skill/建立自己的组件库.html#打包vue" class="sidebar-link">打包Vue</a></li><li class="sidebar-sub-header"><a href="/fundamental/skill/建立自己的组件库.html#vue-use" class="sidebar-link">Vue.use</a></li></ul></li><li><a href="/fundamental/skill/防抖节流.html" class="sidebar-link">防抖节流</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue相关</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="如何建立自己的组件库"><a href="#如何建立自己的组件库" class="header-anchor">#</a> 如何建立自己的组件库</h1> <p>https://www.jb51.net/article/148692.htm</p> <h2 id="npm发包"><a href="#npm发包" class="header-anchor">#</a> npm发包</h2> <ol><li>首先你要在npmjs上注册一个账号</li> <li>查看你的.npmrc设置，确保你的registry是www.npmjs.com/, 如果是一个其他源，可以使用nrm工具切换源</li> <li>在终端npm login，登录你的账号</li></ol> <h2 id="package-json字段解释"><a href="#package-json字段解释" class="header-anchor">#</a> package.json字段解释</h2> <p>name就是发布到npm上的包名，也即别人安装时输入的名字yarn add ${name}, 包名应该是kebab-case, 即英文单词全小写，中划线分割(lower case and dash-separated)
version是语义化的，major.minor.patch. 如果是major变动，通常意味着不兼容的修改; 如果是minor，意味着添加向后兼容的新功能，如果是patch, 意味着bug的修复。
description是对包的描述，在npmjs.com上搜索时会显示，有助于用户在搜索时进行筛选
keywords 同样也是帮助用户查找到你的包
author的格式一般是${your name} ${email}, 当然也可以是一个github地址
license可能很多人会忽略，最好也写上去。至于用哪个，vue的官方项目全是MIT，因此我也是MIT，不纠结
repository的格式参考如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&quot;repository&quot;: {
  &quot;type&quot;: &quot;git&quot;,
  &quot;url&quot;: &quot;https://github.com/FEMessage/el-data-table.git&quot;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>main定义了包的入口文件，在NodeJs环境，语句import pkg from 'package-name'时，其实导入的就是main定义的文件，它可以是CommonJs格式的, 也可以是umd格式
scripts 为了防止出现发包前忘记构建的乌龙事件，定义一下发布前的脚本, 这样每次执行npm publish前都会先执行npm run build</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&quot;prepublishOnly&quot;: &quot;npm run build&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>engines 可以告诉用户运行你的包对NodeJs版本的要求，这是非常重要的，不然你使用了NodeJs新版本特性，却没有定义该字段，导致低版本NodeJs用户运行报错，让人摸不着头脑。</p> <h2 id="定义依赖"><a href="#定义依赖" class="header-anchor">#</a> 定义依赖</h2> <p>当你开发一个项目时，比如一个静态网站或一个单面应用，dependencies和devDependencies并没有太多区别，因为你npm install 或 yarn时，这些依赖都会下载下来，因为你是在开发。
但对于发布到npm的包则不同：
dependencies 是运行你的包必须安装的依赖，即当用户yarn add my-awesome-package时，这些依赖也会下载。devDependencies 是开发你的包时需要安装的依赖，比如eslint, jest等开发工具，当用户yarn add my-awesome-package 时，这些依赖并不会下载！
peerDependencies 一般用于开发插件的场景，它要求用户必须预先安装了某些依赖。比如开发webpack的插件，如果你把对webpack的依赖定义成dependencies, 如果用户安装的webpack跟dependencies里的minor版本不一致, 则用户yarn add my-webpack-plugin时会把dependencies定义的webpack也下载下来，也即用户会安装两个major版本相同的webpack, 这就不合适了。
所以说，定义好你的包的依赖，可以让用户安装使用你的包时少点困惑，多些愉悦。</p> <h2 id="忽略文件"><a href="#忽略文件" class="header-anchor">#</a> 忽略文件</h2> <p>如果有 .gitignore文件，则发布时会忽略 .gitignore中定义的文件;  也即这些文件不需要在.npmignore重新定义。如果用.gitignore忽略了dist目录，但发包时又需要发布dist目录，此时可以在package.json定义files字段，这是一个白名单，里面的文件都会被发布出去</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&quot;files&quot;: [
  &quot;dist&quot;
]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>需要注意的是，子文件夹.gitignore或.npmignore同样有效，而它们会覆盖files字段
另外，有些文件无论如何设置，都不会发布出去：
node_modules
.git(包括.gitignore)</p> <h2 id="readme-md"><a href="#readme-md" class="header-anchor">#</a> README.md</h2> <p>别忘了这个文件，写下与包相关的更具体的信息，告诉用户这个包有哪些功能，如何使用。这很重要，用户不会使用一个没有文档说明的包！</p> <h2 id="发布"><a href="#发布" class="header-anchor">#</a> 发布</h2> <p>一个版本只能发布一次，为了避免每次手动修改package.json, 可以使用npm version [major | minor | patch]命令来更新package.json里的版本</p> <h2 id="打标签"><a href="#打标签" class="header-anchor">#</a> 打标签</h2> <p>假设你的包最新版本是1.0.0, 当用户yarn add my-awesome-package或yarn add my-awesome-package@1.0.0时，其实是相当于yarn add my-awesome-package@latest, 即不指定标签安装时，默认安装latest版本。
假设你正在开发2.0.0版本，它还不稳定，你想发布它让用户测试一波，此时又不能让它变成latest版本，不然用户yarn add my-awesome-package时就安装了2.0.0了，那将让用户崩溃。这时该怎么办呢？
标签就用上场了。可以这样发布</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm publish --tag beta
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>则用户 <strong>yarn add my-awesome-package</strong> 安装的是1.0.0版本， <strong>yarn add my-awesome-package@beta</strong>时，安装的是2.0.0版本，不影响老用户，棒！🎉记住，你只能对一个版本打一个标签，使用npm dist-tag ls 可以查看npm包一共打了几个标签</p> <h2 id="打包vue"><a href="#打包vue" class="header-anchor">#</a> 打包Vue</h2> <p>脚手架经过一番折腾，在Vue Conf上找到一个vue组件的打包脚手架(vue官方文档也有说明)，进行“本土化”修改完善后，已在github开源：github.com/FEMessage/v…</p> <h3 id="说明"><a href="#说明" class="header-anchor">#</a> 说明</h3> <p>我们以开源组件<a href="https://github.com/FEMessage/el-data-table" target="_blank" rel="noopener noreferrer">el-data-table<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>为例，解释目录结构及文件
├── README.md
├── build
│   └── rollup.config.js
├── dist
│   ├── el-data-table.esm.js
│   ├── el-data-table.min.js
│   └── el-data-table.umd.js
├── docs
│   ├── build
│   └── index.html
├── package.json
├── src
│   ├── el-data-table.vue
│   └── index.js
├── styleguide.config.js
├── test
│   └── index.test.js
└── yarn.lock复制代码先来看三个文件:README.mdpackage.jsonyarn.lockREADME.md与package.json大家都懂，有yarn.lock因为是我们鼓励大家使用yarn,  它比npm更快。虽然npm 6.0号称提速17倍(可以想象6之前是得有多慢😂)，但经测试，还是不如yarn接下来看build, dist, src 目录├── build
│   └── rollup.config.js
├── dist
│   ├── el-data-table.esm.js
│   ├── el-data-table.min.js
│   └── el-data-table.umd.js
├── src
│   ├── el-data-table.vue
│   └── index.js复制代码build 目录下放编译时的配置文件，这个跟vue-cli 2.x生成的模板build目录作用是一样的，只不过这里放置的是rollup.config.js。至于为什么用Rollup, 一是因为配置更简单，二是因为它更适合打包类库，当源文件中有import lib from 'awesome-lib'类似的代码时，Rollup并不会把awesome-lib捆绑输出，这正是开发类库或组件需要的特性</p> <h2 id="vue-use"><a href="#vue-use" class="header-anchor">#</a> Vue.use</h2> <p>在组件库的index.js中导出组件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>export default {
    install
    component1,
    component2,
    ...
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在使用时 main.js中</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import XX from 'XX'
Vue.use(XX)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>其中XX即导出的对象，Vue.use会执行XX.install方法,install方法会遍历所有组件并注册到Vue中</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/fundamental/skill/调试.html" class="prev">调试技巧</a></span> <span class="next"><a href="/fundamental/skill/防抖节流.html">防抖节流</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.994bf1ff.js" defer></script><script src="/assets/js/2.9b2c7d50.js" defer></script><script src="/assets/js/23.a3852a2e.js" defer></script>
  </body>
</html>
